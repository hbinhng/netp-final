# App protocol for communication between nodes and gateway

## 1. Handshake

- Client connect to server via host name and port

- Client: `Ping`

- Server: `200 Pong`

## 2. Register a node to gateway

- Client: `register <NODE_TYPE> <GROUP_NAME>`

  `NODE_TYPE`:
    - 1: Temperature sensor
    - 2: Blood pressure sensor
    - 3: ECG (heart beat)
    
  `GROUP_NAME`:
  
    Each monitor device has multiple sensors aka. our `node`. Many `nodes` can have a same GROUP_NAME to group all the data into one presentation.
  
- Server:

  - If the group with `GROUP_NAME` does not exist:
  
    `300 Group and node registered`

  - If the group with `GROUP_NAME` exists, but there's no registered node which is `NODE_TYPE`:
  
    `301 Node registered to a group`
  
  - If the group with `GROUP_NAME` exists and there is already a node which is `NODE_TYPE`:
  
    `309 Group already has similar data source`
    
  - If node did not complete handshake:
  
    `100 Who are you?`
    
**Note**: Client has 2 configurations must be hold on server, don't reimplement with new type of client ID, try reusing connection ID of the worker thread which is responsible for that client.

## 3. Gateway sends configuration to node [when node asks]

- Client: `configure` (optional)

- Server:

  - If node is registered:
  
    `400 <CONFIG_KEY>=<CONFIG_VALUE>[...[,<CONFIG_KEYi>=<CONFIG_VALUEi>]]`
    
  - If node is not registered:
  
    `401 Node is not registered`
    
  - If node did not complete handshake:
  
    `100 Who are you?`

## 4. Data transmitting

- Client: `data <DATA>`

  `DATA`:
  
    Data generated by generator (stringified float).
    
- Server:

  - If node is registered:
  
    `500 Data received`
    
  - If node is not registered:
  
    `401 Node is not registered`
    
  - If node did not complete handshake:
  
    `100 Who are you?`
